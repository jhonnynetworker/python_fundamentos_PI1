<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth-compat.js"></script>

    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyAH-VV4HPr198aYhLL5bOHrEK-KCcNrgRA",
  authDomain: "crosta-crocante.firebaseapp.com",
  projectId: "crosta-crocante",
  storageBucket: "crosta-crocante.appspot.com",
  messagingSenderId: "808538059667",
  appId: "1:808538059667:web:991784909dfd026af42e66",
  measurementId: "G-FDFYQ8KDFD"
};


    // Inicializa o aplicativo Firebase com a configuração fornecida
    firebase.initializeApp(firebaseConfig);

    // Função para fazer login com Google
    function signInWithGoogle() {
        // Cria um provedor de autenticação do Google
        const provider = new firebase.auth.GoogleAuthProvider();
        
        // Inicia o processo de login com um popup
        firebase.auth().signInWithPopup(provider)
            .then((result) => {
                // Obtém as informações do usuário após o login
                const user = result.user;
                const email = user.email;

                // Salva o email no sessionStorage
                sessionStorage.setItem('userEmail', email);

                // Chama a API para verificar se o usuário precisa fornecer informações adicionais
                fetch('http://127.0.0.1:5000/auth/google-login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email }),  // Envia o email do usuário no corpo da requisição
                })
                .then(response => {
                    // Verifica o status da resposta da API
                    if (response.status === 206) {
                        // Dados do usuário incompletos, redireciona para o formulário
                        window.location.href = 'form.html';
                    } else if (response.status === 404) {
                        // Usuário não encontrado, redireciona para o formulário para preencher os detalhes
                        window.location.href = 'form.html';
                    } else if (response.ok) {
                        // Usuário encontrado, redireciona para a página principal
                        window.location.href = 'index2.html';
                        return response.json();
                    } else {
                        // Lida com outros erros potenciais
                        return response.json().then(data => {
                            throw new Error(data.error || 'Failed to log in');
                        });
                    }
                })
                .then(data => {
                    if (data) {
                        // Usuário logado com sucesso, continua o fluxo da aplicação
                        console.log('User data:', data);
                    }
                })
                .catch((error) => {
                    // Exibe o erro no console
                    console.error('Error:', error);
                });
            })
            .catch((error) => {
                // Lida com erros durante o processo de login
                console.error("Error:", error.code, error.message);
            });
    }
</script>
                   
                          
    <title>Document</title>
</head>

<body>
    <h1>Faça login com o Google usando Firebase</h1>
    <button onclick="signInWithGoogle()">Inicia sessão com Google</button>
    
    <br><br><br><br><br><br><br>
    
    
    <div style="position: relative; width: 100%; height: 0; padding-top: 100.0000%;
 padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
 border-radius: 8px; will-change: transform;">
        <iframe loading="lazy"
            style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
            src="https:&#x2F;&#x2F;www.canva.com&#x2F;design&#x2F;DAGE06Ez6OQ&#x2F;6lB1OOvz_pm0lvhPa7lQow&#x2F;view?embed"
            allowfullscreen="allowfullscreen" allow="fullscreen">
        </iframe>
    </div>
    <a href="https:&#x2F;&#x2F;www.canva.com&#x2F;design&#x2F;DAGE06Ez6OQ&#x2F;6lB1OOvz_pm0lvhPa7lQow&#x2F;view?utm_content=DAGE06Ez6OQ&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link"
        target="_blank" rel="noopener">


</body>

</html>
