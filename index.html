<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/3df637a2f2.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth-compat.js"></script>
    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyAH-VV4HPr198aYhLL5bOHrEK-KCcNrgRA",
        authDomain: "crosta-crocante.firebaseapp.com",
        projectId: "crosta-crocante",
        storageBucket: "crosta-crocante.appspot.com",
        messagingSenderId: "808538059667",
        appId: "1:808538059667:web:991784909dfd026af42e66",
        measurementId: "G-FDFYQ8KDFD"
      };
      
      
          // Inicializa o aplicativo Firebase com a configuração fornecida
          firebase.initializeApp(firebaseConfig);
      
          // Função para fazer login com Google
          function signInWithGoogle() {
              // Cria um provedor de autenticação do Google
              const provider = new firebase.auth.GoogleAuthProvider();
              
              // Inicia o processo de login com um popup
              firebase.auth().signInWithPopup(provider)
                  .then((result) => {
                      // Obtém as informações do usuário após o login
                      const user = result.user;
                      const email = user.email;
      
                      // Salva o email no sessionStorage
                      sessionStorage.setItem('userEmail', email);
      
                      // Chama a API para verificar se o usuário precisa fornecer informações adicionais
                      fetch('http://127.0.0.1:5000/auth/google-login', {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json',
                          },
                          body: JSON.stringify({ email }),  // Envia o email do usuário no corpo da requisição
                      })
                      .then(response => {
                          // Verifica o status da resposta da API
                          if (response.status === 206) {
                              // Dados do usuário incompletos, redireciona para o formulário
                              window.location.href = 'form.html';
                          } else if (response.status === 404) {
                              // Usuário não encontrado, redireciona para o formulário para preencher os detalhes
                              window.location.href = 'form.html';
                          } else if (response.ok) {
                              // Usuário encontrado, redireciona para a página principal
                              window.location.href = 'principal.html';
                              return response.json();
                          } else {
                              // Lida com outros erros potenciais
                              return response.json().then(data => {
                                  throw new Error(data.error || 'Failed to log in');
                              });
                          }
                      })
                      .then(data => {
                          if (data) {
                              // Usuário logado com sucesso, continua o fluxo da aplicação
                              console.log('User data:', data);
                          }
                      })
                      .catch((error) => {
                          // Exibe o erro no console
                          console.error('Error:', error);
                      });
                  })
                  .catch((error) => {
                      // Lida com erros durante o processo de login
                      console.error("Error:", error.code, error.message);
                  });
          }
        </script>
    <title>Crosta Crocante</title>
</head>

<body>
    <header>

        <div class="content">
            <div class="logo">
                <h3>Crosta Crocante</h3>
            </div>

    </header>

    <section class="first-section" id="home">

        <div class="conteudo-principal">
            <h1>CROSTA CROCANTE</h1>
            <h2>Deixe o seu dia mais saboroso!!</h2>
            <div class="btn">
                <button onclick="signInWithGoogle()" class="reservar">Reserve já a sua!</button>
            </div>
        </div>
    </section>

    

    <section class="contatos" id="contatos">
        <h3>Contacto</h3>
        <div class="contatos-secao">
            <div>
                <i class="fas fa-phone"></i>
                <span>(+351)
                    987654321</span>
            </div>
            <div>
                <i class="fab fa-instagram"></i>
                <a href="https://www.instagram.com/iguess.caroll">@iguess.caroll</a> 
                <a href="https://www.instagram.com/sgsofia9_">@sgsofia9_</a> 
            </div>
            <div>
                <i class="fab fa-facebook-f"></i>
                <span>Carolina Cardoso &
                    Sofia Mosquera
                </span>
            </div>
        </div>
    </section>
    <footer>
        <h4>Desenvolvido por -> Carolina Cardoso & Laura Gomez</h4>
    </footer>

    <script src="./script.js"></script>
</body>

</html>